<div class="box book-entry {{ entry_class }}" {% if book_id %}data-book-id="{{ book_id }}"{% endif %}>
  <button type="button" class="delete delete-btn" aria-label="Eliminar" title="Borrar libro" tabindex="-1"></button>

  {# Hidden fields for formset #}
  {{ form.id }}
  {% if form.temp_cover_id %}
    {{ form.temp_cover_id }}
  {% endif %}

  <div class="is-flex" style="gap: 1rem;">
    {% if form.temp_cover_id %}
    {# Left column: Image and upload button (only for offered books) #}
    <div class="is-flex-shrink-0 is-flex is-flex-direction-column" style="gap: 0.5rem;">
      <div class="temp-photo-container is-flex is-align-items-center book-cover-container" data-form-prefix="{{ form.prefix }}">
        {% if form.instance.cover_image %}
          <img src="{{ form.instance.cover_image.url }}" alt="Cover" class="book-cover-image">
        {% else %}
          <div class="book-placeholder book-cover-container"></div>
        {% endif %}
      </div>
      <div>
        <input type="file" name="temp_cover_image" accept="image/*" capture="environment" style="display: none;" class="temp-photo-input" data-form-prefix="{{ form.prefix }}">
        <button type="button" class="button is-info is-small is-light temp-upload-trigger" data-form-prefix="{{ form.prefix }}">
          <span class="icon is-small">
            <i class="fas fa-camera"></i>
          </span>
          <span class="temp-upload-text">{% if form.instance.cover_image %}Cambiar foto{% else %}Agregar foto{% endif %}</span>
        </button>
      </div>
    </div>
    {% endif %}

    {# Right column: Form fields #}
    <div class="is-flex-grow-1">
      <div class="field">
        <input class="input" type="text" name="{{ form.title.html_name }}" id="{{ form.title.id_for_label }}" value="{{ form.title.value|default:'' }}" placeholder="TÃ­tulo del libro">
        {% if form.title.errors %}
          <p class="help is-danger">{{ form.title.errors.0 }}</p>
        {% endif %}
      </div>
      <div class="field">
        <input class="input" type="text" name="{{ form.author.html_name }}" id="{{ form.author.id_for_label }}" value="{{ form.author.value|default:'' }}" placeholder="Autor">
        {% if form.author.errors %}
          <p class="help is-danger">{{ form.author.errors.0 }}</p>
        {% endif %}
      </div>
      {% if form.notes %}
      <div class="field">
        {{ form.notes }}
        {% if form.notes.errors %}
          <p class="help is-danger">{{ form.notes.errors.0 }}</p>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>

  {# Hidden DELETE checkbox (we'll handle this with JavaScript) #}
  <div style="display: none;">
    {{ form.DELETE }}
  </div>
</div>
