{% extends "base_logged.html" %}
{% load static %}

{% block extra_css %}{% endblock %}

{% block logged_content %}
<div class="columns is-centered">
  <div class="column is-full-mobile is-8-tablet is-6-desktop">
    <h1 class="title is-4 mb-2">Mis libros deseados</h1>
    <p class="mb-4 has-text-grey">
      Agregá abajo los libros que estás buscando.
    </p>

    <form method="post" id="books-form">
      {% csrf_token %}
      {{ formset.management_form }}

      <div id="books-container">
        {% for form in formset %}
          {% include "_book_form_entry.html" with form=form entry_class=forloop.last|yesno:"new-entry," book_id=form.instance.pk %}
        {% endfor %}
      </div>

      {# Template for new entries - using Django's empty_form #}
      <template id="empty-form-template">
        {% include "_book_form_entry.html" with form=formset.empty_form entry_class="new-entry" %}
      </template>

      <div class="field is-grouped is-grouped-right mt-4">
        <div class="control">
          <button type="button" class="button" id="cancel-btn">
            <span id="cancel-btn-text">Volver</span>
          </button>
        </div>
        <div class="control" id="save-btn-container" style="display: none;">
          <button type="submit" class="button is-primary">
            Guardar cambios
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<script src="{% static 'js/book_formset_manager.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  initBookFormset({
    profileUrl: "{% url 'profile' username=request.user.username %}"
  });
});
</script>
{% endblock %}
