{% extends "base_logged.html" %}

{% block logged_content %}
<div class="columns is-centered">
  <div class="column is-8-tablet is-6-desktop">
    <h1 class="title">
      {% if user.profile %}Tu perfil{% else %}Completá tu perfil{% endif %}
    </h1>

    <form method="post">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="notification is-danger is-light">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <div class="field">
        <label class="label">Ubicación <span class="has-text-danger">*</span></label>
        <div class="control">
          <div class="location-grid">
            <label class="tag is-medium is-light location-tag" style="cursor: pointer">
              <input type="checkbox" name="locations" value="CABA_NORTE" {% if 'CABA_NORTE' in form.locations.value|default:'' %}checked{% endif %} style="margin-right: 0.5rem" />
              CABA Norte
            </label>
            <label class="tag is-medium is-light location-tag" style="cursor: pointer">
              <input type="checkbox" name="locations" value="CABA_CENTRO" {% if 'CABA_CENTRO' in form.locations.value|default:'' %}checked{% endif %} style="margin-right: 0.5rem" />
              CABA Centro
            </label>
            <label class="tag is-medium is-light location-tag" style="cursor: pointer">
              <input type="checkbox" name="locations" value="CABA_SUR" {% if 'CABA_SUR' in form.locations.value|default:'' %}checked{% endif %} style="margin-right: 0.5rem" />
              CABA Sur
            </label>
            <label class="tag is-medium is-light location-tag" style="cursor: pointer">
              <input type="checkbox" name="locations" value="GBA_NORTE" {% if 'GBA_NORTE' in form.locations.value|default:'' %}checked{% endif %} style="margin-right: 0.5rem" />
              GBA Norte
            </label>
            <label class="tag is-medium is-light location-tag" style="cursor: pointer">
              <input type="checkbox" name="locations" value="GBA_OESTE" {% if 'GBA_OESTE' in form.locations.value|default:'' %}checked{% endif %} style="margin-right: 0.5rem" />
              GBA Oeste
            </label>
            <label class="tag is-medium is-light location-tag" style="cursor: pointer">
              <input type="checkbox" name="locations" value="GBA_SUR" {% if 'GBA_SUR' in form.locations.value|default:'' %}checked{% endif %} style="margin-right: 0.5rem" />
              GBA Sur
            </label>
          </div>
        </div>
        {% if form.locations.errors %}
          <p class="help is-danger">{{ form.locations.errors.0 }}</p>
        {% endif %}
        <p>
          Seleccioná las zonas donde quieras intercambiar libros.
          Te vamos a mostrar libros de esas zonas.
        </p>
      </div>

      <div class="box">
        <h2 class="title is-5">Datos de contacto</h2>
        <p class="mb-4">
          Esta información será compartida cuando envíes solicitudes de
          intercambio. No forma parte de tu perfil público.
        </p>

        <div class="field">
          <label class="label">Nombre <span class="has-text-danger">*</span></label>
          <div class="control">
            <input class="input" type="text" name="first_name" value="{{ form.first_name.value|default:'' }}" placeholder="Tu nombre" required />
          </div>
          {% if form.first_name.errors %}
            <p class="help is-danger">{{ form.first_name.errors.0 }}</p>
          {% endif %}
        </div>

        <div class="field">
          <label class="label">Email <span class="has-text-danger">*</span></label>
          <div class="control">
            <input class="input" type="email" name="email" value="{{ form.email.value|default:'' }}" placeholder="tu@email.com" required />
          </div>
          {% if form.email.errors %}
            <p class="help is-danger">{{ form.email.errors.0 }}</p>
          {% endif %}
        </div>

        <div class="field">
          <label class="label">Contacto alternativo</label>
          <div class="control">
            <input class="input" type="text" name="alternate_contact" value="{{ form.alternate_contact.value|default:'' }}" placeholder="@usuario, teléfono, etc." />
          </div>
          {% if form.alternate_contact.errors %}
            <p class="help is-danger">{{ form.alternate_contact.errors.0 }}</p>
          {% endif %}
          <p class="help">
            Opcional: otra forma de contactarte (WhatsApp, Instagram, etc.)
          </p>
        </div>
      </div>

      <div class="field">
        <label class="label">Acerca de vos</label>
        <div class="control">
          <textarea class="textarea" name="about" rows="4" placeholder="Lo que quieras que se vea en tu perfil público.">{{ form.about.value|default:'' }}</textarea>
        </div>
        {% if form.about.errors %}
          <p class="help is-danger">{{ form.about.errors.0 }}</p>
        {% endif %}
      </div>

      <div class="field mt-5 has-text-centered">
        <div class="control">
          <button class="button is-primary" type="submit">
            Guardar perfil
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<style>
  .location-grid {
    display: grid;
    gap: 0.5rem;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  }
  @media screen and (min-width: 769px) {
    .location-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  .location-tag {
    transition: all 0.15s;
  }
  .location-tag.is-light:hover:not(.is-info) {
    background-color: hsl(0, 0%, 90%) !important;
  }
</style>

<script>
  // Update tag styling based on checkbox state
  document.querySelectorAll(".location-tag").forEach((tag) => {
    const checkbox = tag.querySelector('input[type="checkbox"]');

    // Update tag style based on checkbox state
    function updateTagStyle() {
      if (checkbox.checked) {
        tag.classList.remove("is-light");
        tag.classList.add("is-info");
      } else {
        tag.classList.remove("is-info");
        tag.classList.add("is-light");
      }
    }

    // Initialize style on page load
    updateTagStyle();

    // Update style whenever checkbox changes
    // The label already handles toggling the checkbox, we just update the visual style
    checkbox.addEventListener("change", updateTagStyle);
  });
</script>
{% endblock %}
